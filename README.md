**Поиск и предложение похожих товаров**

Этот проект посвящен поиску и формированию предложений 5 наиболее похожих товаров для каждого товара из запроса.

В нашем распоряжении данные о товарах от одного из крупнейших маркетплейсов страны. Разработаем алгоритм, который для каждого товара из запроса предложит 5 вариантов наиболее похожих товаров. Оценка качества алгоритма проводена по метрике accuracy@5.

Данные:

- *`base.csv`* - анонимизированный набор товаров. Каждый товар представлен как уникальный id (0-base, 1-base, 2-base) и вектор признаков размерностью 72.
- *`target.csv`* - обучающий датасет. Каждая строчка - один товар, для которого известен уникальный id (0-query, 1-query, …) , вектор признаков и `id` товара из *`base.csv`*, который максимально похож на него (по мнению экспертов).
- *`validation.csv`* - датасет с товарами (уникальный id и вектор признаков), для которых надо найти наиболее близкие товары из *`base.csv`*
- *`validation_answer.csv`* - правильные ответы к файлу `validation.csv`.

Для поиска ближайших векторов, состоящих из 72 признаков товаров, применена библиотека faiss с использованием метода кластеризации для ускорения работы алгоритма на большом объеме данных.

При начальных условиях, использовав исходные данные без обработки с количеством кластеров = 1 алгоритм поиска блиайших векторов показывает низкий результат и длительное время работы.

При анализе признаков выявлено, что большинство из них, за исключением 8 признаков, имеют нормальное распределение с различным средним и дисперсией.

Для проверки возможности повышения качества поиска было применено:
* *масштабирование признаков* (применено несколько методов нормализации и трансформации признаков, лучший - StandardScaler);
* *подбор количества кластеров* (в пределе 0.2 от корня из общего количества векторов до корня из общего количества. Лучший результат получен при пазбиении выборки на количество кластеров, равное квадратному корню из количества объектов в выборке для поиска и количеством рассматриваемых кластеров равным 20% от общего их количества);
* *удаление признаков с распределением, отличным от нормального* (при удалении таких признаков точность поиска существенно возрастает).

Выбранный метод поиска схожих векторов выдает на тренировочной выборке результат около 71%. 
Целесообразно исследовать возможность повышения точности поиска путем последующего применения ранжирующей модели машинного обучения. Для этого также вычислены топ 50, 100, 200, 400 ближайших векторов.

С увеличением числа ближайших векторов до 50 точность выросла ориентировочно на 8%. При увеличении числа ближайших векторов в интервале от 50 до 400 точность повышается незначительно, на 1-1,5% для каждого из интервалов (50:100, 100:200, 200:400).  

Исследована возможность повышения точности поиска 5 похожих товаров путем применения ранжирующей модели машинного обучения для топ 50, 100, 200, 400 ближайших векторов. Применение модели на данных выборка дает сравнимый результат точности, но увеличение числа ближайших векторов приводит к увеличению времени обучения и предсказания модели. 

Эмпирическим путем в качестве оптимального варианта для ранжирования была выбрана выборка из топ 100 векторов, отобранных методом кластеризации из библиотеки Faiss.    

В качестве ранжирующей модели машинного обучения выбрана модель CatBoostClassifier. 

Для модели машинного обучения удаление признаков с расределением, отличным от нормального, приводит к существенному (около 10%) снижению качества ранжирования.  

Проведен подбор гиперпараметров модели с использованием optuna. Проведено итерационное дообучение модели на всем объеме тренировочной выборки.  

Дополнительное применение модели машинного обучения на выборке из топ 100 ближайших векторов ориентировочно увеличивает точность поиска на 3%. 

**Использование комбинированного метода поиска ближайших векторов и использования ранжирующей модели позволило для каждого товара из запроса сформировать топ 5 наиболее похожих товаров с общей точностью около 74%.** 

Дополнительно комбированный поиск развернут с использованием веб-фреймворка FastApi на основе веб-сервера unicorn (match_api.py), обрабатывающего get запросы со списком товаров, для которых требуется подобрать 5 наиболее похожих вариантов.  
